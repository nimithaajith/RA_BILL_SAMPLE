{% extends 'project/base.html' %}
{% load static %}
{% load custom_filters %}
{% block scriptcontent %}
<script src="{% static 'project/js/boq.js' %}"></script>   
      
{% endblock %}
{% block navcontent %}
{% endblock %}
{% block maincontent %}
{% if msg %}
<div >    
    <h2 class="form-heading text-danger fw-bolder m-3">{{msg}}</h2>     
</div>
{% endif %} 

{% if page_object %}
<div class="card border-primary mt-3 mx-3 p-2" style="background-color: rgba(255, 255, 255, 0.253)">
    
        <h4 class="fw-bold text-light">Work Order - Bill Of Quantities</h4>

    <div class="inline-items ">
        <span class=" bg-secondary border border-primary text-light p-3 fw-bold">Total Pages : {{page_object.paginator.num_pages}} (Showing 100 items per page)</span>
        {% if page_object.has_previous %}
            <a href="{% url 'project:ManageBOQ' page_object.number|add:'-1' %}" class="btn btn-custom m-1 rounded-circle"><i class="far fa-arrow-alt-circle-left py-1 " style='font-size:36px'></i></a> 
        {% endif %}
        <span class="mx-2 bg-secondary border border-primary  text-light p-3"><b>Current Page : {{page_object.number}}</b></span>
        {% if page_object.has_next %}
            <a href="{% url 'project:ManageBOQ' page_object.number|add:'1' %}" class="btn btn-custom m-1 rounded-circle"><i class="far fa-arrow-alt-circle-right py-1 " style='font-size:36px'></i></a> 
        {% endif %}
        <span class=" bg-secondary border border-primary text-light p-3 fw-bold">BoQ Grand Total : {{grandtotal}}</span>
        
    </div>
    
    <table class="table  bg-light border border-primary me-3 p-2 shadow-lg" id="boqtable" >
        <thead class="bg-secondary text-light">
            <tr>
                <th scope="col" style="width: 150px;">DATE</th> 
                <th scope="col">SL NO</th>
                <th scope="col">ITEM DESCRIPTION</th>
                <th scope="col">QUANTITY</th>
                <th scope="col">RATE</th>
                <th scope="col">UNITS</th>
                <th scope="col">AMOUNT</th>                               
                <th scope="col">VIEW</th>
            </tr>
        </thead>
        <tbody >
            
            {% for object in page_object %}
                {% if not object.extra_item %}
                    {% if object.heading %}
                        <tr class="fw-bolder">
                            <td></td> 
                            {% if object.serial_no == 'nan' %}  
                            <td></td>  
                            {% else %}                            
                            <td >{{object.serial_no}}</td>
                            {% endif %}
                            <td >{{object.description}}</td>  
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td><a href="{% url 'project:DeleteItem' object.id %}" class="text-danger">Remove</a></td>                                                       
                        </tr>
                    {% else %}                        
                        <tr >
                            <th>{{object.work_order_date}}</th>
                            {% if object.serial_no == 'nan' %}  
                            <td></td>  
                            {% else %}                            
                            <td>{{object.serial_no}}</td>
                            {% endif %}
                            
                            <td >{{object.description}}</td>
                            <td>{{object.quantity}}</td>
                            <td>{{object.rate}}</td>
                            <td>{{object.unit}}</td>
                            <td>{{object.amount}}</td>     
                            
                            <td>
                                <a href="{% url 'project:ManageItem' object.id %}" >
                                Edit</a>
                            </td>                
                        
                        </tr>
                    {% endif %}
                {% else %}
                    <!-- {% if object.subheading %} 
                        <tr >
                            <td></td>
                            {% with object.subheading|split:"&&&" as parts %}
                            <td class="text-primary fw-bolder">{{ parts.0 }}</td>
                            <td class="text-primary fw-bolder">{{ parts.1 }}</td>
                            {% endwith %}
                        </tr>        
                    {% endif %} -->
                    <tr >
                        <th scope="row">{{object.work_order_date}}</th>
                        {% if object.serial_no == 'nan' %}  
                        <td></td>  
                        {% else %}                            
                        <td>{{object.serial_no}}</td>
                        {% endif %}                        
                        <td ><p style="color: rgb(255, 0, 55);font-size:20px;">Extra Item : </p>{{object.description}}</td>
                        <td>{{object.quantity}}</td>
                        <td>{{object.rate}}</td>
                        <td>{{object.unit}}</td>
                        <td>{{object.amount}}</td>     
                        
                        <td>
                            <a href="{% url 'project:ManageItem' object.id %}" >Edit</a>
                        </td>
                        
                        <!-- <td>
                            <a href="" class="btn btn-custom m-1 rounded-circle">
                            <i class='fas fa-trash py-2' style='color:red;font-size:20px;'></i></a>
                        </td> -->
                    </tr>                    
                {% endif %}
            {% endfor %}             
        </tbody>
    </table>
    
    <div class="inline-items ">
        <span class="mx-2 bg-secondary border border-primary  text-light p-3 fw-bold">Total Pages : {{page_object.paginator.num_pages}} (Showing 100 items per page)</span>
        {% if page_object.has_previous %}
            <a href="{% url 'project:ManageBOQ' page_object.number|add:'-1' %}" class="btn btn-custom m-1 rounded-circle"><i class="far fa-arrow-alt-circle-left py-1 " style='font-size:36px'></i></a> 
        {% endif %}
        <span class="mx-2 bg-secondary border border-primary  text-light p-3"><b>Current Page : {{page_object.number}}</b></span>
        {% if page_object.has_next %}
            <a href="{% url 'project:ManageBOQ' page_object.number|add:'1' %}" class="btn btn-custom m-1 rounded-circle"><i class="far fa-arrow-alt-circle-right py-1 " style='font-size:36px'></i></a> 
        {% endif %} 
        <span class=" bg-secondary border border-primary text-light p-3 fw-bold">BoQ Grand Total : {{grandtotal}}</span>       
    </div> 
       
</div>    
{% endif %}


<div class="card border-primary mt-5 mx-4 p-5" style="background-color: rgba(255, 255, 255, 0.253)">
    {% if msg %}
    <h2 class="form-heading text-danger fw-bolder m-3">{{msg}}</h2>
    {% endif %}         
             
        
    <form class="p-0 text-primary px-4" action="{% url 'project:ManageBOQ' 1 %}" id="wo_boq_form" method="POST" >
        {% csrf_token %}  
        <div class="row my-0"> 
            <h2 class="form-heading m-3  ">Add extra item to BoQ</h2> 
        </div>
        <div class="row  my-0 bg-light"> 
                              
            <div class="col my-3 border border-primary p-5 form-box">    
            
                <!-- {% if subheading_exists %}
                <label class="text-dark">Choose an existing subheading or Enter new subheading below.(Optional)</label>
                <select name="subheading" id="subheading" class="form-control">
                    <option value="">Click here and select</option>
                    {% for heading in subheading_list %}
                        <option value="{{ heading }}">{% with heading|split:"&&&" as parts %}
                            {{ parts.0 }} - {{ parts.1 }}
                        {% endwith %}</option>
                    {% endfor %}
                </select>
                {% endif %} -->
                <!-- <label for="subheadnew" class="mt-3 text-dark">Enter serial_no</label>
                <div class="row">
                    <div class="col">
                        <input type="text" id="newserialno" name="newserialno" class="form-control mb-3" placeholder="Enter Serial No. of subheading"> 
                    </div>
                    <div class="col">
                        <input type="text" id="newsubhead" name="newsubhead" class="form-control mb-3" placeholder="Enter Subheading"> 
                    </div>
                </div> -->
                <div class="row">
                    <label for="itemdesc" class=" text-dark">Enter Item Description</label>
                    <textarea rows="2" id="itemdesc" name="itemdesc" class="form-control mb-3 rounded-0" required> </textarea>               
                </div> 
            </div>
            <div class="col border border-primary form-box"> 
                <div class="row">
                    <div class="col">
                        <label for="serialno" class=" text-dark">Enter Item Serial number</label>
                        <input type="text" id="serialno" name="serialno" class="form-control mb-3" required>                
                    </div>
                    <!-- <div class="col">
                        <label class="text-dark ">If extra item to basic BoQ.</label>
                        <select name="extraitem" id="extraitem" class="form-control">
                            <option value="">Click here and select</option>
                            <option value="No">No</option>
                            <option value="Yes">Yes</option>                    
                        </select>
                    </div> -->
                    <div class="col">
                        <label for="wo_date" class=" px-3 text-dark">Select entry date</label>
                        <input type="date" id="wo_date" name="wo_date" class="form-control mb-3 w-100"  style="width: fit-content;" required>                
                    </div>                    
                </div> 
                    
                <div class="row">
                    <div class="col">
                        <label for="quantity" class=" text-dark">Enter Item Quantity</label>
                        <input type="number" step="0.01" id="quantity" name="quantity" class="form-control mb-3" required>                
                    </div>
                    <div class="col">
                        <label for="rate" class=" text-dark">Enter Item Rate</label>
                        <input type="number" step="0.01" id="rate" name="rate" class="form-control mb-3" required>                
                        
                    </div> 
                    
                    <div class="col">
                        <label for="unit" class="text-dark">Enter Item Unit</label>
                        <input type="text" id="unit" name="unit" class="form-control mb-3" required>                
                    </div>
                </div>   
                <div class="row">        
                    
                    <div class="col">
                        <button class="form-btn-custom border border-0 w-100 mt-5 px-3" type="submit"><i class="fa-solid fa-file-excel" style="color: blue;"></i> Add To BoQ</button>
                    </div>
                </div>
            </div>
        </div>
                     
    </form>              
    
</div> 
{% endblock %}
