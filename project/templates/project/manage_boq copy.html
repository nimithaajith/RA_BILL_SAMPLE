{% extends 'project/base.html' %}
{% load static %}
{% load custom_filters %}
{% block scriptcontent %}
<script src="{% static 'project/js/boq.js' %}"></script>   
      
{% endblock %}
{% block navcontent %}
{% endblock %}
{% block maincontent %}
<div class="card border-primary mt-5 mx-4 p-5" style="background-color: rgba(255, 255, 255, 0.253)">
    {% if msg %}
    <h2 class="form-heading text-danger fw-bolder m-3">{{msg}}</h2>
    {% endif %}  
</div>

{% if page_object %}
<div class="card-trans border-primary mt-5 m-3 p-3" style="background-color: rgba(255, 255, 255, 0.253)">
    <center>
        <h2 class="m-3 fw-bold">Work Order - Bill Of Quantities</h2>
    </center>
    <div class="inline-items ">
        <span class="mx-2 bg-dark text-light p-3 fw-bold">Total Pages : {{page_object.paginator.num_pages}} (Showing 20 items per page)</span>
        {% if page_object.has_previous %}
            <a href="{% url 'project:ManageBOQ' page_object.number|add:'-1' %}" class="btn btn-custom m-1 rounded-circle"><i class="fas fa-reply text-primary py-2"></i></a> 
        {% endif %}
        <span class="mx-2 bg-dark text-light p-3"><b>Current Page : {{page_object.number}}</b></span>
        {% if page_object.has_next %}
            <a href="{% url 'project:ManageBOQ' page_object.number|add:'1' %}" class="btn btn-custom m-1 rounded-circle"><i class="fas fa-share text-primary py-2"></i></a> 
        {% endif %}
        <span class="ms-5">  
            <small style="font-size: 15px;font-weight: bold;color: orangered;">*Extra items in BoQ will be marked with <i class="fas fa-plus p-2" style="color: rgb(255, 0, 55);font-size:20px;"></i> symbol</small>          
            <!-- <form id="phonesearchfrm" action="{% url 'projectadmin:SearchProjects' %}" method="post">
            {% csrf_token %}
                <div class="input-group inline text-primary border-0" >                    
                    <input type="search" id="searchproject"  name="searchproject" class="inline fw-bold w-auto bg-dark text-primary border border-0 px-5" placeholder="Enter project username">
                    <button type="submit" class="btn  btn-custom text-primary rounded-circle ms-1 "><i class="fa fa-search py-2" aria-hidden="true"></i></button>
                </div>
            </form>
            <small style="font-size: 15px;font-weight: bold;color: orangered;">*Search project by registered username</small>
             -->
        </span> 
    </div>
    
    <table class="table table-bordered bg-light border-primary m-2 p-3 shadow-lg" id="boqtable" style="max-width: 95%;font-weight: bold;">
        <thead class="bg-dark text-light">
            <tr>
                <th scope="col">DATE</th> 
                <th scope="col">SERIAL NO</th>
                <th scope="col">ITEM DESCRIPTION</th>
                <th scope="col">QUANTITY</th>
                <th scope="col">RATE</th>
                <th scope="col">UNITS</th>
                <th scope="col">AMOUNT</th>                               
                <th scope="col">VIEW</th>
            </tr>
        </thead>
        <tbody >
            <!-- {% if subheading_exists %} -->
                <!-- {% for heading in subheading_list %} -->
                <!-- <tr >
                    <td></td>
                    {% with heading|split:"&&&" as parts %}
                    <td class="text-primary fw-bolder">{{ parts.0 }}</td>
                    <td class="text-primary fw-bolder">{{ parts.1 }}</td>
                    {% endwith %}                
                </tr> -->
                    {% for object in page_object %}
                    {% if not object.extra_item %}
                        {% if object.heading %}
                            <tr>                                 
                                <td class="text-primary fw-bolder">{{object.serial_no}}</td>
                                <td class="text-primary fw-bolder">{{object.description}}</td>                                                         
                            </tr>
                        {% else %}
                        <!-- {% if object.headings %} -->
                            <!-- <script>
                                deleteLastRow();
                            </script> -->
                        
                            <!-- {% with object.headings|split:"|||" as hlist %}
                                {% for h in hlist %}
                                    <tr >
                                        <td></td>
                                        {% with h|split:"&&&" as parts %}
                                        <td class="text-primary fw-bolder">{{ parts.0 }}</td>
                                        <td class="text-primary fw-bolder">{{ parts.1 }}</td>
                                        {% endwith %}                          
                                        
                                    </tr>
                                {% endfor %}
                            {% endwith %} -->
                            <!-- <tr >
                                <td></td>
                                {% with heading|split:"&&&" as parts %}
                                <td class="text-primary fw-bolder">{{ parts.0 }}</td>
                                <td class="text-primary fw-bolder">{{ parts.1 }}</td>
                                {% endwith %}                           
                            </tr>
                        {% endif %} -->
                        <tr >
                            <th scope="row">{{object.work_order_date}}</th>
                            <td>{{object.serial_no}}</td>
                            <td >{{object.description}}</td>
                            <td>{{object.quantity}}</td>
                            <td>{{object.rate}}</td>
                            <td>{{object.unit}}</td>
                            <td>{{object.amount}}</td>     
                            
                            <td>
                                <a href="{% url 'project:ManageItem' object.id %}" class="btn btn-custom m-1 rounded-circle">
                                <i class="fas fa-eye py-2" style="color: blue;font-size:20px;"></i></a>
                            </td>
                            
                            <!-- <td>
                                <a href="" class="btn btn-custom m-1 rounded-circle">
                                <i class='fas fa-trash py-2' style='color:red;font-size:20px;'></i></a>
                            </td> -->
                        </tr>
                        {% endif %}

                    {% endfor %}
                <!-- {% endfor %} -->
            <!-- {% endif %}             -->
                {% for object in page_object %}
                    {% if not object.extra_item  and not object.subheading %}
                    <tr >
                        <th scope="row">{{object.work_order_date}}</th>
                        <td>{{object.serial_no}}</td>
                        <td >{{object.description}}</td>
                        <td>{{object.quantity}}</td>
                        <td>{{object.rate}}</td>
                        <td>{{object.unit}}</td>
                        <td>{{object.amount}}</td>     
                        
                        <td>
                            <a href="{% url 'project:ManageItem' object.id %}" class="btn btn-custom m-1 rounded-circle">
                            <i class="fas fa-eye py-2" style="color: blue;font-size:20px;"></i></a>
                        </td>
                        
                        <!-- <td>
                            <a href="" class="btn btn-custom m-1 rounded-circle">
                            <i class='fas fa-trash py-2' style='color:red;font-size:20px;'></i></a>
                        </td> -->
                    </tr>
                    {% endif %}
                {% endfor %}

           

            <!-- extra added items displayed at the end of boq -->
            {% if extra_subheading_list %}
                {% for eheading in extra_subheading_list %}
                <tr >
                    <td></td>
                    {% with eheading|split:"&&&" as parts %}
                    <td class="text-primary fw-bolder">{{ parts.0 }}</td>
                    <td class="text-primary fw-bolder">{{ parts.1 }}</td>
                    {% endwith %}
                </tr>    
                    {% for object in page_object %}
                        {% if object.subheading == eheading and object.extra_item  %}
                        
                        <tr >
                            <th scope="row">{{object.work_order_date}}</th>
                            <td>{{object.serial_no}}</td>
                            <td ><i class="fas fa-plus p-2" style="color: rgb(255, 0, 55);font-size:20px;"></i>{{object.description}}</td>
                            <td>{{object.quantity}}</td>
                            <td>{{object.rate}}</td>
                            <td>{{object.unit}}</td>
                            <td>{{object.amount}}</td>     
                            
                            <td>
                                <a href="{% url 'project:ManageItem' object.id %}" class="btn btn-custom m-1 rounded-circle">
                                <i class="fas fa-eye py-2" style="color: blue;font-size:20px;"></i></a>
                            </td>
                            
                            <!-- <td>
                                <a href="" class="btn btn-custom m-1 rounded-circle">
                                <i class='fas fa-trash py-2' style='color:red;font-size:20px;'></i></a>
                            </td> -->
                        </tr>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            {% endif %}
                    {% for object in page_object %}
                    {% if object.extra_item and not object.subheading %}
                    <tr >
                        <th scope="row">{{object.work_order_date}}</th>
                        <td>{{object.serial_no}}</td>
                        <td ><i class="fas fa-plus p-2" style="color: rgb(255, 0, 55);font-size:20px;"></i>{{object.description}}</td>
                        <td>{{object.quantity}}</td>
                        <td>{{object.rate}}</td>
                        <td>{{object.unit}}</td>
                        <td>{{object.amount}}</td>     
                        
                        <td>
                            <a href="{% url 'project:ManageItem' object.id %}" class="btn btn-custom m-1 rounded-circle">
                            <i class="fas fa-eye py-2" style="color: blue;font-size:20px;"></i></a>
                        </td>
                        
                        <!-- <td>
                            <a href="" class="btn btn-custom m-1 rounded-circle">
                            <i class='fas fa-trash py-2' style='color:red;font-size:20px;'></i></a>
                        </td> -->
                    </tr>
                    {% endif %}
                {% endfor %}
            
        </tbody>
    </table>
    <span class="ms-5">  
        <small style="font-size: 15px;font-weight: bold;color: orangered;">*Extra items in BoQ will be marked with <i class="fas fa-plus p-2" style="color: rgb(255, 0, 55);font-size:20px;"></i> symbol</small>          
        
    </span> 
</div>
    
{% endif %}


<div class="card border-primary mt-5 mx-4 p-5" style="background-color: rgba(255, 255, 255, 0.253)">
    {% if msg %}
    <h2 class="form-heading text-danger fw-bolder m-3">{{msg}}</h2>
    {% endif %}    
          
             
        
    <form class="p-0 text-primary px-4" action="{% url 'project:ManageBOQ' 1 %}" id="wo_boq_form" method="POST" >
        {% csrf_token %}  
        <div class="row my-0"> 
            <h2 class="form-heading m-3  ">Add extra item to BoQ</h2> 
        </div>
        <div class="row  my-0 bg-light"> 
                              
            <div class="col my-3 border border-primary p-5 form-box">    
            
                <!-- {% if subheading_exists %}
                <label class="text-dark">Choose an existing subheading or Enter new subheading below.(Optional)</label>
                <select name="subheading" id="subheading" class="form-control">
                    <option value="">Click here and select</option>
                    {% for heading in subheading_list %}
                        <option value="{{ heading }}">{% with heading|split:"&&&" as parts %}
                            {{ parts.0 }} - {{ parts.1 }}
                        {% endwith %}</option>
                    {% endfor %}
                </select>
                {% endif %} -->
                <label for="subheadnew" class="mt-3 text-dark">Enter sub-heading(If any)(Optional)</label>
                <div class="row">
                    <div class="col">
                        <input type="text" id="newserialno" name="newserialno" class="form-control mb-3" placeholder="Enter Serial No. of subheading"> 
                    </div>
                    <div class="col">
                        <input type="text" id="newsubhead" name="newsubhead" class="form-control mb-3" placeholder="Enter Subheading"> 
                    </div>
                </div>
                <div class="row">
                    <label for="itemdesc" class=" text-dark">Enter Item Description</label>
                    <textarea rows="2" id="itemdesc" name="itemdesc" class="form-control mb-3 rounded-0" required> </textarea>               
                </div> 
            </div>
            <div class="col border border-primary form-box"> 
                <div class="row">
                    <div class="col">
                        <label for="serialno" class=" text-dark">Enter Item Serial number</label>
                        <input type="text" id="serialno" name="serialno" class="form-control mb-3" required>                
                    </div>
                    <!-- <div class="col">
                        <label class="text-dark ">If extra item to basic BoQ.</label>
                        <select name="extraitem" id="extraitem" class="form-control">
                            <option value="">Click here and select</option>
                            <option value="No">No</option>
                            <option value="Yes">Yes</option>                    
                        </select>
                    </div> -->
                    <div class="col">
                        <label for="wo_date" class=" px-3 text-dark">Select entry date</label>
                        <input type="date" id="wo_date" name="wo_date" class="form-control mb-3 w-100"  style="width: fit-content;" required>                
                    </div>                    
                </div> 
                    
                <div class="row">
                    <div class="col">
                        <label for="quantity" class=" text-dark">Enter Item Quantity</label>
                        <input type="number" step="0.01" id="quantity" name="quantity" class="form-control mb-3" required>                
                    </div>
                    <div class="col">
                        <label for="rate" class=" text-dark">Enter Item Rate</label>
                        <input type="number" step="0.01" id="rate" name="rate" class="form-control mb-3" required>                
                        
                    </div> 
                    <div class="col">
                        <label for="amount" class="text-dark">Item Amount</label>
                        <input type="number" step="0.01" name="amount" id="amount" class="form-control" required>
                    </div>
                    <div class="col">
                        <label for="unit" class="text-dark">Enter Item Unit</label>
                        <input type="text" id="unit" name="unit" class="form-control mb-3" required>                
                    </div>
                </div>   
                <div class="row">        
                    
                    <div class="col">
                        <button class="form-btn-custom border border-0 w-100 mt-5 px-3" type="submit"><i class="fa-solid fa-file-excel" style="color: blue;"></i> Add To BoQ</button>
                    </div>
                </div>
            </div>
        </div>
                     
    </form>              
    
</div>    


 

{% endblock %}
